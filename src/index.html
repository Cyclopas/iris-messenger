<!DOCTYPE html>
<html>

<head>
  <title>Iris Messenger</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
  <link rel="stylesheet" type="text/css" href="./style.css">
  <link rel="shortcut icon" href="./favicon.ico">
  <script>
    var userAgent = navigator.userAgent.toLowerCase();
    var isElectron = (userAgent.indexOf(' electron/') > -1);
    if (!isElectron && ('serviceWorker' in navigator)) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('serviceworker.js')
        .then(function(registration) {
          // Registration was successful
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        })
        .catch(function(err) {
          // registration failed :(
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }
  </script>
</head>

<body>
  <div class="chat">
    <section class="sidebar hidden-xs">
      <div class="user-info">
        <div id="my-identicon"></div>
        <div class="user-name"></div>
      </div>
      <div id="enable-notifications-prompt">
        <div class="title">Get notified of new messages</div>
        <div><a>Turn on desktop notifications ></a></div>
      </div>
      <div class="chat-list">
        <div class="chat-item new">
          Start new chat
        </div>
        <div id="welcome" class="visible-xs-block">
          <h3>Iris Messenger</h3>
          <img src="icon128.png" width="64" height="64" alt="iris it is">
        </div>
      </div>
    </section>

    <section class="main">
      <header>
        <div id="back-button" class="visible-xs-inline-block">â€¹</div>
        <div id="header-content"></div>
      </header>

      <!-- Chat view -->
      <div class="main-view" id="message-view">
        <div id="message-list"></div>
      </div>
      <div id="not-seen-by-them" style="display: none">
        <p>The other person hasn't seen this chat yet. Give them <b>your</b> chat link through some other channel:</p>
        <p><button class="copy-chat-link">Copy your chat link</button></p>
      </div>
      <div class="message-form" style="display:none">
        <form autocomplete="off">
          <button type="button" id="emoji-picker">
            <svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="smile" class="svg-inline--fa fa-smile fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z"></path></svg>
          </button>
          <input id="new-msg" type="text" placeholder="Type a message">
          <button type="submit">
            <svg class="svg-inline--fa fa-w-16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 486.736 486.736" style="enable-background:new 0 0 486.736 486.736;" xml:space="preserve" width="100px" height="100px" fill="#000000" stroke="#000000" stroke-width="0"><path fill="currentColor" d="M481.883,61.238l-474.3,171.4c-8.8,3.2-10.3,15-2.6,20.2l70.9,48.4l321.8-169.7l-272.4,203.4v82.4c0,5.6,6.3,9,11,5.9 l60-39.8l59.1,40.3c5.4,3.7,12.8,2.1,16.3-3.5l214.5-353.7C487.983,63.638,485.083,60.038,481.883,61.238z"></path></svg>
          </button>
        </form>
      </div>

      <!-- New chat view -->
      <div class="main-view" id="new-chat">
        <p><input id="paste-chat-link" type="text" placeholder="Paste someone's chat link"></p>
        <p><button class="copy-chat-link">Copy your chat link</button></p>
        <p id="my-qr-code"></p>
        <p>Give your chat link to someone you want to chat with!</p>
        <p><button id="generate-chat-link">Create new link</button></p>
        <table id="my-chat-links" class="striped-rows"></table>
      </div>

      <!-- Settings view -->
      <div class="main-view" id="settings">
        <h3>Profile</h3>
        <p>
          Your name:
        </p>
        <p>
          <input id="settings-name" placeholder="Your name">
        </p>
        <p>
          Profile photo:
        </p>
        <img id="current-profile-photo">
        <button id="add-profile-photo">Add profile photo</button>
        <img id="profile-photo-preview" class="hidden">
        <p>
          <input name="profile-photo-input" type="file" class="hidden" id="profile-photo-input" accept="image/*">
        </p>
        <p id="profile-photo-error" class="hidden">Profile photo too big: maximum size is 200KB</p>
        <p>
          <button id="cancel-profile-photo" class="hidden">Cancel</button>
          <button id="use-profile-photo" class="hidden">Use photo</button>
          <button id="remove-profile-photo" class="hidden">Remove photo</button>
        </p>
        <h3>Account</h3>
        <p>
          <b>Save a backup of your private key first!</b> Otherwise you can't log in back to this account.
        </p>
        <p>
          <button class="show-logout-confirmation">Log out</button>
        </p>
        <p>
          <button class="show-switch-account">Switch account</button>
        </p>
        <h3>Private key</h3>
        <p>
          <b>DANGER!</b> Private key is used to <b>log in to your account</b>. Keep your private key safe!
        </p>
        <p>
          <button id="download-private-key">Download private key</button>
          <button id="copy-private-key">Copy private key</button>
        </p>
        <h3>Peers</h3>
        <table id="peers" class="striped-rows">
          <tr id="add-peer-row">
            <td colspan="3"><input id="add-peer-input" placeholder="Peer url"></td>
            <td><button id="add-peer-btn">Add</button></td>
          </tr>
        </table>

        <h3>About</h3>
        <p>Iris is like the messaging apps we've used to, but better.</p>
        <ul>
          <li><b>No phone number or signup required.</b> Just start using it!</li>
          <li><b>Secure</b>: It's open source. Users can validate that big brother doesn't read your messages.</li>
          <li><b>Available</b>: It works offline-first and is not dependent on any single centrally managed server. Users can even connect directly to each other.</li>
        </ul>
        <p>Released under MIT license. Code: <a href="https://github.com/irislib/iris-messenger">Github</a>.</p>
        <h3>Privacy</h3>
        <p>Messages are end-to-end encrypted, but message timestamps aren't. It is also possible, if not trivial, to find out who are communicating with each other by monitoring data subscriptions on the decentralized database.</p>
        <p>Profile names and photos are currently public.</p>
      </div>

      <!-- Logout confirmation -->
      <div class="main-view" id="logout-confirmation">
        <p>
          You <b>cannot log in again</b> unless you have saved a copy of your private key.
        </p>
        <p>
          <button class="open-settings-button">Go back</button>
        </p>
        <p>
          <button class="logout-button">Log out</button>
        </p>
      </div>

      <!-- Login view -->
      <div class="main-view" id="switch-account">
        <input id="paste-privkey" placeholder="Paste a private key">
      </div>

      <!-- Profile view -->
      <div class="main-view" id="profile">
        <div class="profile-photo-container"><img class="profile-photo"></div>
        <div class="content">
          <p class="status"></p>
          <p class="last-active"></p>
          <p>
            <button class="send-message">Send message</button>
            <button class="copy-user-link">Copy link</button>
          </p>
          <p id="profile-page-qr"></p>
          <!--
          <p>
            <button class="add-friend">Add to friends</button>
          </p>
          -->
          <p>
            <button class="delete-chat">Delete chat</button>
            <!-- <button class="block-user">Block user</button> -->
          </p>
        </div>
      </div>

    </section>
  </div>

  <script src="./jquery.js"></script>
  <script src="./gun.js"></script>
  <script src="./sea.js"></script>
  <script src="./nts.js"></script>
  <script src="./irisLib.js"></script>
  <script src="./emoji-button.js"></script>
  <script src="./Autolinker.min.js"></script>
  <script src="./qrcode.min.js"></script>
  <script src="./helpers.js"></script>
  <script src="./app.js"></script>
</body>

</html>
