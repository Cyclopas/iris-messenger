<!DOCTYPE html>
<html>

<head>
  <title>Iris Messenger</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
  <link rel="stylesheet" type="text/css" href="./style.css">
  <link rel="shortcut icon" href="./favicon.ico">
  <script>
    var userAgent = navigator.userAgent.toLowerCase();
    var isElectron = (userAgent.indexOf(' electron/') > -1);
    if (!isElectron && ('serviceWorker' in navigator)) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('serviceworker.js')
        .then(function(registration) {
          // Registration was successful
          console.log('ServiceWorker registration successful with scope: ', registration.scope);
        })
        .catch(function(err) {
          // registration failed :(
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }
  </script>
</head>

<body>
  <div class="chat">
    <section class="sidebar hidden-xs">
      <div class="user-info">
        <div id="my-identicon"></div>
        <div class="user-name"></div>
      </div>
      <div id="enable-notifications-prompt">
        <div class="title">Get notified of new messages</div>
        <div><a>Turn on desktop notifications ></a></div>
      </div>
      <div class="chat-list">
        <div class="chat-item new">
          Start new chat
        </div>
        <div id="welcome" class="visible-xs-block">
          <h3>Iris Messenger</h3>
          <img src="icon128.png" width="64" height="64" alt="iris it is">
        </div>
      </div>
    </section>

    <section class="main">
      <header>
        <div id="back-button" class="visible-xs-inline-block">â€¹</div>
        <div id="header-content"></div>
      </header>

      <!-- Chat view -->
      <div class="main-view" id="message-view">
        <div id="message-list"></div>
      </div>
      <div id="not-seen-by-them" style="display: none">
        <p>The other person hasn't seen this chat yet. Give them <b>your</b> chat link through some other channel:</p>
        <p><button class="copy-chat-link">Copy your chat link</button></p>
      </div>
      <div class="message-form" style="display:none">
        <form autocomplete="off">
          <button type="button" id="emoji-picker">
            <svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="smile" class="svg-inline--fa fa-smile fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z"></path></svg>
          </button>
          <input id="new-msg" type="text" placeholder="Type a message">
          <button type="submit">
            <svg class="svg-inline--fa fa-w-16" version="1.1" id="IconsRepoEditor" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 210 210" style="enable-background:new 0 0 210 210;" xml:space="preserve" width="100px" height="100px" fill="#000000" stroke="#000000" stroke-width="0"><path fill="currentColor" d="M190.32,90.03L36.784,2.266C34.137,0.754,31.19,0,28.243,0c-0.06,0-0.119,0.008-0.178,0.008 c-0.396,0.004-0.791,0.024-1.185,0.055c-0.178,0.014-0.355,0.033-0.533,0.053c-0.308,0.034-0.615,0.077-0.921,0.128 c-0.111,0.019-0.223,0.025-0.334,0.046l0.006,0.008c-1.913,0.353-3.78,1.027-5.515,2.034c-5.314,3.083-8.585,8.762-8.585,14.905 v175.527c0,6.143,3.271,11.822,8.585,14.905c1.734,1.007,3.601,1.682,5.514,2.035l-0.005,0.007c0.1,0.019,0.201,0.025,0.3,0.041 c0.329,0.056,0.659,0.102,0.99,0.137c0.166,0.018,0.331,0.036,0.497,0.049c0.389,0.031,0.777,0.049,1.167,0.054 c0.066,0.001,0.131,0.009,0.197,0.009c2.947,0,5.894-0.754,8.541-2.266L190.32,119.97c5.368-3.069,8.681-8.777,8.681-14.962 c0,0,0-0.003,0-0.004c0,0,0-0.003,0-0.004c0,0,0-0.003,0-0.004c0,0,0-0.003,0-0.004C199.001,98.808,195.688,93.1,190.32,90.03z M129.602,72.601l-15.266,20.027L75.496,41.672L129.602,72.601z M182.876,106.947l-107.38,61.381l67.234-88.206l40.145,22.947 c0.695,0.397,1.127,1.141,1.127,1.938C184.001,105.807,183.569,106.551,182.876,106.947z"></path></svg>
          </button>
        </form>
      </div>

      <!-- New chat view -->
      <div class="main-view" id="new-chat">
        <p><input id="paste-chat-link" type="text" placeholder="Paste someone's chat link"></p>
        <p><button class="copy-chat-link">Copy your chat link</button></p>
        <p id="my-qr-code"></p>
        <p>Give your chat link to someone you want to chat with!</p>
        <p><button id="generate-chat-link">Create new link</button></p>
        <table id="my-chat-links" class="striped-rows"></table>
      </div>

      <!-- Settings view -->
      <div class="main-view" id="settings">
        <h3>Profile</h3>
        <p>
          Your name:
        </p>
        <p>
          <input id="settings-name" placeholder="Your name">
        </p>
        <p>
          Profile photo:
        </p>
        <img id="current-profile-photo">
        <button id="add-profile-photo">Add profile photo</button>
        <img id="profile-photo-preview" class="hidden">
        <p>
          <input name="profile-photo-input" type="file" class="hidden" id="profile-photo-input" accept="image/*">
        </p>
        <p id="profile-photo-error" class="hidden">Profile photo too big: maximum size is 200KB</p>
        <p>
          <button id="cancel-profile-photo" class="hidden">Cancel</button>
          <button id="use-profile-photo" class="hidden">Use photo</button>
          <button id="remove-profile-photo" class="hidden">Remove photo</button>
        </p>
        <h3>Account</h3>
        <p>
          <b>Save a backup of your private key first!</b> Otherwise you can't log in back to this account.
        </p>
        <p>
          <button class="show-logout-confirmation">Log out</button>
        </p>
        <p>
          <button class="show-switch-account">Switch account</button>
        </p>
        <h3>Private key</h3>
        <p>
          <b>DANGER!</b> Private key is used to <b>log in to your account</b>. Keep your private key safe!
        </p>
        <p>
          <button id="download-private-key">Download private key</button>
          <button id="copy-private-key">Copy private key</button>
        </p>
        <h3>Peers</h3>
        <table id="peers" class="striped-rows">
          <tr id="add-peer-row">
            <td colspan="3"><input id="add-peer-input" placeholder="Peer url"></td>
            <td><button id="add-peer-btn">Add</button></td>
          </tr>
        </table>

        <h3>About</h3>
        <p>Iris is like the messaging apps we've used to, but better.</p>
        <ul>
          <li><b>No phone number or signup required.</b> Just start using it!</li>
          <li><b>Secure</b>: It's open source. Users can validate that big brother doesn't read your messages.</li>
          <li><b>Available</b>: It works offline-first and is not dependent on any single centrally managed server. Users can even connect directly to each other.</li>
        </ul>
        <p>Released under MIT license. Code: <a href="https://github.com/irislib/iris-messenger">Github</a>.
      </div>

      <!-- Logout confirmation -->
      <div class="main-view" id="logout-confirmation">
        <p>
          You <b>cannot log in again</b> unless you have saved a copy of your private key.
        </p>
        <p>
          <button class="open-settings-button">Go back</button>
        </p>
        <p>
          <button class="logout-button">Log out</button>
        </p>
      </div>

      <!-- Login view -->
      <div class="main-view" id="switch-account">
        <input id="paste-privkey" placeholder="Paste a private key">
      </div>

      <!-- Profile view -->
      <div class="main-view" id="profile">
        <h2 class="name"></h2>
        <div class="status"></div>
        <div class="last-active"></div>
        <div><img class="profile-photo"></div>
        <div class="profile-link"></div>
        <div class="profile-link-qr"></div>
        <div><button>Send message</button></div>
      </div>

    </section>
  </div>

  <script src="./jquery.js"></script>
  <script src="./gun.js"></script>
  <script src="./sea.js"></script>
  <script src="./nts.js"></script>
  <script src="./irisLib.js"></script>
  <script src="./emoji-button.js"></script>
  <script src="./Autolinker.min.js"></script>
  <script src="./qrcode.min.js"></script>
  <script src="./helpers.js"></script>
  <script src="./app.js"></script>
</body>

</html>
